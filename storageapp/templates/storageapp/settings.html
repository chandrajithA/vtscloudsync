{% extends base_template %}
{% load static %}

{% block title %}Settings - Cloudsync{% endblock %}

{% block style %}
<link rel="stylesheet" href="{% static 'css/settings.css' %}">
{% endblock %}

{% block content %}
<div class="settings-page">

    <h2 class="settings-title">Settings</h2>
    <p class="settings-subtitle">Manage your account and preferences</p>

    <div class="settings-card">
        <h3>Profile Information</h3>

        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- Avatar row -->
            <div class="avatar-row">
                <div class="avatar" id="avatarPreview">
                    {% if request.user.profile_picture %}
                        <img src="{{ request.user.profile_picture.url }}" id="avatarImg">
                    {% else %}
                        <span id="avatarText">
                            {{ request.user.first_name|slice:":1"|upper }}
                        </span>
                    {% endif %}
                </div>

                <div class="avatar-actions">
                    <label class="upload-btn">
                        Upload photo
                        <input type="file" name="profile_picture" id="profileInput" accept="image/*">
                    </label>

                    {% if request.user.profile_picture %}
                    <button type="submit" name="remove_photo" class="remove-btn">
                        Remove
                    </button>
                    {% endif %}
                </div>
            </div>

            <!-- Form grid -->
            <div class="form-grid">
                <div>
                    <label>First name</label>
                    <input type="text" name="first_name" value="{{ request.user.first_name }}">
                </div>

                <div>
                    <label>Last name</label>
                    <input type="text" name="last_name" value="{{ request.user.last_name }}">
                </div>

                <div>
                    <label>Email address</label>
                    <input type="email" name="email" value="{{ request.user.email }}">
                </div>

                <div>
                    <label>Phone number</label>
                    <input type="text" name="phone" value="{{ request.user.phone }}">
                </div>
            </div>

            <!-- Buttons -->
            <div class="form-actions">
                <button type="submit" class="save-btn">Save Changes</button>
                <a href="{% url 'storageapp:dashboard' %}" class="cancel-btn">Cancel</a>
            </div>

        </form>
    </div>
</div>
{% endblock %}


{% block script %}
<script>
const input = document.getElementById("profileInput");
const avatar = document.getElementById("avatarPreview");

input?.addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    if (!file.type.startsWith("image/")) {
        alert("Please select a valid image");
        this.value = "";
        return;
    }

    const reader = new FileReader();
    reader.onload = function (e) {
        avatar.innerHTML = `<img src="${e.target.result}" id="avatarImg">`;
    };
    reader.readAsDataURL(file);
});
</script>

{% endblock %}



